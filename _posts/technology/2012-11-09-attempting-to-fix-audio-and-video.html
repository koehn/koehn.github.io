---
layout: techpost
title: Attempting to fix audio and video
---

After reading a bunch, I'm trying a few new things to get the video and audio to use their respective hardware components:<br /><br />The intel VAAPI drivers install into <code>/usr/lib/dri</code>, which isn't on the default library path. So I put a new file <code>/etc/ld.so.conf.d/intel-drivers</code> containing only the line, "<code>/usr/lib/dri</code>" (without quotes) in an attempt to get it loaded.<br /><br />The audio situation has been more complicated. There are a million devices available to the ALSA framework, as shown here:<br /><br /><pre>$ aplay -l<br />**** List of PLAYBACK Hardware Devices ****<br />card 0: PCH [HDA Intel PCH], device 0: ALC889 Analog [ALC889 Analog]<br />  Subdevices: 1/1<br />  Subdevice #0: subdevice #0<br />card 0: PCH [HDA Intel PCH], device 1: ALC889 Digital [ALC889 Digital]<br />  Subdevices: 1/1<br />  Subdevice #0: subdevice #0<br />card 0: PCH [HDA Intel PCH], device 3: HDMI 0 [HDMI 0]<br />  Subdevices: 1/1<br />  Subdevice #0: subdevice #0</pre><pre>&nbsp;</pre><pre>$ aplay -L<br />null<br />&nbsp;&nbsp;&nbsp; Discard all samples (playback) or generate zero samples (capture)<br />pulse<br />&nbsp;&nbsp;&nbsp; PulseAudio Sound Server<br />sysdefault:CARD=PCH<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; Default Audio Device<br />front:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; Front speakers<br />surround40:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; 4.0 Surround output to Front and Rear speakers<br />surround41:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; 4.1 Surround output to Front, Rear and Subwoofer speakers<br />surround50:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; 5.0 Surround output to Front, Center and Rear speakers<br />surround51:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; 5.1 Surround output to Front, Center, Rear and Subwoofer speakers<br />surround71:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; 7.1 Surround output to Front, Center, Side, Rear and Woofer speakers<br />iec958:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Digital<br />&nbsp;&nbsp;&nbsp; IEC958 (S/PDIF) Digital Audio Output<br />hdmi:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, HDMI 0<br />&nbsp;&nbsp;&nbsp; HDMI Audio Output<br />dmix:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; Direct sample mixing device<br />dmix:CARD=PCH,DEV=1<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Digital<br />&nbsp;&nbsp;&nbsp; Direct sample mixing device<br />dmix:CARD=PCH,DEV=3<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, HDMI 0<br />&nbsp;&nbsp;&nbsp; Direct sample mixing device<br />dsnoop:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; Direct sample snooping device<br />dsnoop:CARD=PCH,DEV=1<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Digital<br />&nbsp;&nbsp;&nbsp; Direct sample snooping device<br />dsnoop:CARD=PCH,DEV=3<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, HDMI 0<br />&nbsp;&nbsp;&nbsp; Direct sample snooping device<br />hw:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; Direct hardware device without any conversions<br />hw:CARD=PCH,DEV=1<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Digital<br />&nbsp;&nbsp;&nbsp; Direct hardware device without any conversions<br />hw:CARD=PCH,DEV=3<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, HDMI 0<br />&nbsp;&nbsp;&nbsp; Direct hardware device without any conversions<br />plughw:CARD=PCH,DEV=0<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Analog<br />&nbsp;&nbsp;&nbsp; Hardware device with all software conversions<br />plughw:CARD=PCH,DEV=1<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, ALC889 Digital<br />&nbsp;&nbsp;&nbsp; Hardware device with all software conversions<br />plughw:CARD=PCH,DEV=3<br />&nbsp;&nbsp;&nbsp; HDA Intel PCH, HDMI 0<br />&nbsp;&nbsp;&nbsp; Hardware device with all software conversions</pre><pre>&nbsp;</pre><pre>$ cat  /proc/asound/card0/codec#3<br />Codec: Intel CougarPoint HDMI<br />Address: 3<br />AFG Function Id: 0x1 (unsol 0)<br />Vendor Id: 0x80862805<br />Subsystem Id: 0x80860101<br />Revision Id: 0x100000<br />No Modem Function Group found<br />Default PCM:<br />    rates [0x0]:<br />    bits [0x0]:<br />    formats [0x0]:<br />Default Amp-In caps: N/A<br />Default Amp-Out caps: N/A<br />GPIO: io=0, o=0, i=0, unsolicited=0, wake=0<br />Node 0x02 [Audio Output] wcaps 0x6611: 8-Channels Digital<br />  Converter: stream=0, channel=0<br />  Digital: Enabled<br />  Digital category: 0x0<br />  PCM:<br />    rates [0x7f0]: 32000 44100 48000 88200 96000 176400 192000<br />    bits [0x1e]: 16 20 24 32<br />    formats [0x5]: PCM AC3<br />  Power states:  D0 D3 EPSS<br />  Power: setting=D0, actual=D0<br />Node 0x03 [Audio Output] wcaps 0x6611: 8-Channels Digital<br />  Converter: stream=0, channel=0<br />  Digital: Enabled<br />  Digital category: 0x0<br />  PCM:<br />    rates [0x7f0]: 32000 44100 48000 88200 96000 176400 192000<br />    bits [0x1e]: 16 20 24 32<br />    formats [0x5]: PCM AC3<br />  Power states:  D0 D3 EPSS<br />  Power: setting=D0, actual=D0<br />Node 0x04 [Audio Output] wcaps 0x6611: 8-Channels Digital<br />  Converter: stream=0, channel=0<br />  Digital: Enabled<br />  Digital category: 0x0<br />  PCM:<br />    rates [0x7f0]: 32000 44100 48000 88200 96000 176400 192000<br />    bits [0x1e]: 16 20 24 32<br />    formats [0x5]: PCM AC3<br />  Power states:  D0 D3 EPSS<br />  Power: setting=D0, actual=D0<br />Node 0x05 [Pin Complex] wcaps 0x40778d: 8-Channels Digital Amp-Out CP<br />  Amp-Out caps: ofs=0x00, nsteps=0x00, stepsize=0x00, mute=1<br />  Amp-Out vals:  [0x00 0x80]<br />  Pincap 0x09000094: OUT Detect HBR HDMI DP<br />  Pin Default 0x58560010: [N/A] Digital Out at Int HDMI<br />    Conn = Digital, Color = Unknown<br />    DefAssociation = 0x1, Sequence = 0x0<br />  Pin-ctls: 0x40: OUT<br />  Unsolicited: tag=00, enabled=0<br />  Power states:  D0 D3 EPSS<br />  Power: setting=D0, actual=D0<br />  Connection: 1<br />     0x02<br />Node 0x06 [Pin Complex] wcaps 0x40778d: 8-Channels Digital Amp-Out CP<br />  Amp-Out caps: ofs=0x00, nsteps=0x00, stepsize=0x00, mute=1<br />  Amp-Out vals:  [0x00 0x80]<br />  Pincap 0x09000094: OUT Detect HBR HDMI DP<br />  Pin Default 0x58560020: [N/A] Digital Out at Int HDMI<br />    Conn = Digital, Color = Unknown<br />    DefAssociation = 0x2, Sequence = 0x0<br />  Pin-ctls: 0x40: OUT<br />  Unsolicited: tag=00, enabled=0<br />  Power states:  D0 D3 EPSS<br />  Power: setting=D0, actual=D0<br />  Connection: 1<br />     0x03<br />Node 0x07 [Pin Complex] wcaps 0x40778d: 8-Channels Digital Amp-Out CP<br />  Control: name="HDMI/DP,pcm=3 Jack", index=0, device=0<br />  Control: name="IEC958 Playback Con Mask", index=1, device=0<br />  Control: name="IEC958 Playback Pro Mask", index=1, device=0<br />  Control: name="IEC958 Playback Default", index=1, device=0<br />  Control: name="IEC958 Playback Switch", index=1, device=0<br />  Control: name="ELD", index=0, device=3<br />  Amp-Out caps: ofs=0x00, nsteps=0x00, stepsize=0x00, mute=1<br />  Amp-Out vals:  [0x00 0x00]<br />  Pincap 0x09000094: OUT Detect HBR HDMI DP<br />  Pin Default 0x18560030: [Jack] Digital Out at Int HDMI<br />    Conn = Digital, Color = Unknown<br />    DefAssociation = 0x3, Sequence = 0x0<br />  Pin-ctls: 0x00:<br />  Unsolicited: tag=01, enabled=1<br />  Power states:  D0 D3 EPSS<br />  Power: setting=D0, actual=D0<br />  Connection: 1<br />     0x04<br />Node 0x08 [Vendor Defined Widget] wcaps 0xf00000: Mono<br />&nbsp;</pre><pre>&nbsp;</pre><pre>&nbsp;</pre>If I were a betting man, I'd guess that the one I want is probably <code>hw:CARD=PCH,DEV=3</code>. It looks as though that's the one that passes the audio directly out the HDMI cable, unmolested. We'll see when I get home tonight. 
